<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Maggie Bakery | Reservations</title>

  <style>
    :root{
      --green:#0f3d2e;
      --gold:#c9a86a;
      --gold2:#b89655;

      --bgText: rgba(255,255,255,.86);
      --text:#16221c;
      --muted:#5c6b63;

      --card: rgba(255,255,255,.92);
      --stroke: rgba(201,168,106,.22);
      --strokeSoft: rgba(0,0,0,.08);
      --shadow: 0 60px 140px rgba(0,0,0,.35);
      --radius: 28px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      min-height: 100vh;
      color: var(--text);
      background: linear-gradient(rgba(13,55,40,.76), rgba(13,55,40,.90));
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Background image */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:url("images/restaurant.jpg") center/cover no-repeat;
      filter: blur(5px) brightness(.90) saturate(1.05);
      transform: scale(1.05);
      z-index:-2;
    }

    /* Ambient overlays */
    body::after{
      content:"";
      position:fixed;
      inset:0;
      background:
        radial-gradient(900px 600px at 15% 8%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(900px 600px at 90% 24%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(rgba(13,55,40,.30), rgba(13,55,40,.62));
      z-index:-1;
    }

    .wrap{
      max-width: 920px;
      margin: 56px auto;
      padding: 0 16px 64px;
    }

    /* Top hero small line */
    .topline{
      display:flex;
      justify-content:center;
      gap:10px;
      align-items:center;
      color: var(--bgText);
      font-size: 12px;
      letter-spacing:.08em;
      text-transform: uppercase;
      margin-bottom: 14px;
    }
    .dot{
      width:4px;height:4px;border-radius:99px;
      background: rgba(201,168,106,.9);
      box-shadow: 0 0 0 3px rgba(201,168,106,.18);
    }

    .card{
      background: var(--card);
      backdrop-filter: blur(18px);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow);
      border: 1px solid var(--stroke);
      overflow:hidden;
      position:relative;
    }

    /* subtle gold line */
    .card::before{
      content:"";
      position:absolute;
      inset: 0 auto auto 0;
      height: 3px;
      width: 100%;
      background: linear-gradient(90deg, rgba(201,168,106,.0), rgba(201,168,106,.65), rgba(201,168,106,.0));
      opacity:.65;
    }

    /* Header (centered) */
    .brand{
      font-size: 22px;
      letter-spacing: .24em;
      text-transform: uppercase;
      color: var(--gold);
      font-weight: 900;
      text-align:center;
      margin: 6px 0 12px;
    }

    .sub{
      margin:0;
      text-align:center;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    /* ‚Äúmenu style‚Äù info stack */
    .info{
      margin-top: 18px;
      display:grid;
      gap:10px;
      justify-content:center;
    }

    .pill{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 999px;
      background: rgba(15,61,46,.065);
      border: 1px solid rgba(15,61,46,.10);
      color: rgba(15,61,46,.86);
      font-size: 12px;
      font-weight: 700;
      width: min(520px, 100%);
      margin: 0 auto;
    }

    .pill .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 22px;
      height: 22px;
      border-radius: 7px;
      background: rgba(201,168,106,.18);
      border: 1px solid rgba(201,168,106,.28);
      color: rgba(120,86,30,.95);
      font-weight: 900;
      font-size: 12px;
      flex: 0 0 auto;
    }

    /* Address link */
    .pill a{
      color: rgba(15,61,46,.86);
      text-decoration:none;
      border-bottom: 1px solid rgba(15,61,46,.18);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* Request-only (thin gold outline) */
    .pill.gold{
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(201,168,106,.55);
      color: rgba(120,86,30,.92);
      font-weight: 750;
    }
    .pill.gold .badge{
      background: rgba(201,168,106,.14);
      border-color: rgba(201,168,106,.35);
    }

    /* Call button inline */
    .call{
      text-decoration:none;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(201,168,106,.45);
      background: rgba(201,168,106,.16);
      color: rgba(120,86,30,.96);
      font-weight: 900;
      font-size: 12px;
      line-height: 1;
      transition: .18s ease;
      flex: 0 0 auto;
    }
    .call:hover{
      background: rgba(201,168,106,.24);
      transform: translateY(-1px);
    }

    /* Form */
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      margin-top: 22px;
    }

    label{
      display:block;
      font-size:13px;
      margin:12px 0 6px;
      color: rgba(15,61,46,.88);
      font-weight: 750;
    }

    input,select,textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid var(--strokeSoft);
      background:#fff;
      font-size: 15px;
      outline:none;
      transition:.15s;
      color:#1f2d26;
    }

    input::placeholder, textarea::placeholder{
      color: rgba(31,45,38,.42);
    }

    input:focus,select:focus,textarea:focus{
      border-color: rgba(201,168,106,.75);
      box-shadow: 0 0 0 4px rgba(201,168,106,.18);
    }

    textarea{ min-height: 96px; resize: vertical; }

    /* Submit */
    .btn{
      margin-top: 18px;
      width:100%;
      border:0;
      border-radius: 18px;
      padding: 15px;
      font-size: 16px;
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      background: linear-gradient(135deg, var(--gold), var(--gold2));
      color:#fff;
      cursor:pointer;
      transition: all .20s ease;
    }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(0,0,0,.22);
    }
    .btn:disabled{
      background:#d8d3c7;
      color:#7c7568;
      cursor:not-allowed;
      box-shadow:none;
      transform:none;
    }

    .note{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
      text-align:center;
    }

    /* Toasts */
    .toast{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      font-size: 14px;
      display:none;
      border: 1px solid rgba(0,0,0,.06);
    }
    .ok{
      color:#1c6f48;
      background:#e7f7ee;
      border-color:#cceedd;
      animation: pop .24s ease-out;
    }
    .bad{
      color:#8b1a1a;
      background:#ffecec;
      border-color:#ffd6d6;
      animation: pop .24s ease-out;
    }

    @keyframes pop{
      from{ transform: translateY(4px); opacity: .0; }
      to{ transform: translateY(0); opacity: 1; }
    }

    /* Time buttons UI */
    .sr-only{
      position:absolute !important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }

    .time-grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin-top: 8px;
    }

    .time-btn{
      appearance:none;
      border:1px solid rgba(0,0,0,.10);
      background:#fff;
      color:#1f2d26;
      padding:10px 10px;
      border-radius:14px;
      font-size:14px;
      font-weight:800;
      cursor:pointer;
      transition: all .15s ease;
      text-align:center;
      user-select:none;
    }

    .time-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(0,0,0,.08);
      border-color: rgba(201,168,106,.35);
    }

    .time-btn.selected{
      border-color: rgba(201,168,106,.85);
      box-shadow: 0 0 0 4px rgba(201,168,106,.18);
      background: linear-gradient(180deg, rgba(201,168,106,.12), rgba(201,168,106,.06));
    }

    .time-btn.disabled{
      opacity:.45;
      cursor:not-allowed;
      transform:none !important;
      box-shadow:none !important;
    }

    .hint{
      margin-top:8px;
      font-size:12px;
      color: var(--muted);
    }

    .foot{
      margin-top: 14px;
      text-align:center;
      font-size:12px;
      color: rgba(255,255,255,.78);
    }
    .foot a{
      color: rgba(255,255,255,.92);
      text-decoration: none;
      border-bottom: 1px solid rgba(255,255,255,.35);
    }

    /* Mobile */
    @media(max-width:720px){
      .wrap{ margin: 22px auto; }
      .card{ padding: 22px; border-radius: 26px; }
      .grid{ grid-template-columns:1fr; }
      .time-grid{ grid-template-columns: repeat(3, 1fr); }
      .brand{ font-size: 20px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topline">
      <span class="dot"></span>
      <span>Reservations</span>
      <span class="dot"></span>
    </div>

    <div class="card">
      <div class="brand">MAGGIE BAKERY</div>
      <p class="sub">Submit a request and we‚Äôll confirm your booking shortly.</p>

      <div class="info">
        <div class="pill">
          <div class="left">
            <span class="badge">‚è∞</span>
            <span>Open 10am ‚Äì 7pm</span>
          </div>
          <a class="call" href="tel:+64223189478">Call</a>
        </div>

        <div class="pill">
          <div class="left">
            <span class="badge">üìç</span>
            <a target="_blank" rel="noopener"
               href="https://www.google.com/maps/search/?api=1&query=1%2F200%20Dairy%20Flat%20Highway">
              1/200 Dairy Flat Highway
            </a>
          </div>
          <span style="opacity:.75;">Directions</span>
        </div>

        <div class="pill gold">
          <div class="left">
            <span class="badge">‚ú¶</span>
            <span>Request only ¬∑ Confirmation required</span>
          </div>
          <span style="opacity:.82;">Thank you</span>
        </div>
      </div>

      <form id="form" method="POST" target="hidden_iframe">

        <div class="grid">
          <div>
            <label>Name</label>
            <input name="name" required autocomplete="name" />
          </div>
          <div>
            <label>Phone</label>
            <input name="phone" required autocomplete="tel" />
          </div>
        </div>

        <div class="grid">
          <div>
            <label>Email (optional)</label>
            <input name="email" type="email" autocomplete="email" />
          </div>
          <div>
            <label>Guests</label>
            <select name="guests" id="guests" required>
              <option value="">Select</option>
              <option>1</option><option>2</option><option>3</option><option>4</option>
              <option>5</option><option>6</option><option>7</option><option>8</option>
              <option value="8+">8+</option>
            </select>
          </div>
        </div>

        <div class="grid">
          <div>
            <label>Date</label>
            <input name="date" id="date" type="date" required />
          </div>

          <div>
            <label>Time</label>

            <div id="timeGrid" class="time-grid" aria-live="polite"></div>

            <select name="time" id="time" required class="sr-only" tabindex="-1" aria-hidden="true">
              <option value="">Select a date first</option>
            </select>

            <div class="hint" id="timeHint">Select a date first</div>
          </div>
        </div>

        <label>Notes (optional)</label>
        <textarea name="notes" placeholder="Allergies, birthday message, pram/high chair, special requests..."></textarea>

        <button class="btn" id="btn" type="submit">Request a booking</button>

        <div class="note">
          For <strong>8+ guests</strong>, please call us. We‚Äôll confirm availability by phone/text.
        </div>

        <div class="toast ok" id="ok">Submitted! We‚Äôll confirm shortly.</div>
        <div class="toast bad" id="bad"></div>
      </form>

      <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>
    </div>

    <div class="foot">
      Need help? <a href="tel:+64223189478">Call us</a>
    </div>
  </div>

<script>
  // Apps Script Web App URL
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzUcA0p5RGkTLYTLQC6gtcJTWPKhpTxQmkWWP1HLTLn-XYvn9bcxue8Bax8Td3iHj3eGA/exec";

  // ‚úÖ reservation slots: 10:00‚Äì18:00 (10am‚Äì6pm), 30-min slots
  const OPEN_HOURS = { start: "10:00", end: "18:00" };
  const SLOT_MINUTES = 30;

  const $ = (id) => document.getElementById(id);

  const form = $("form");
  const iframe = $("hidden_iframe");
  const dateEl = $("date");
  const timeEl = $("time");
  const timeGrid = $("timeGrid");
  const timeHint = $("timeHint");
  const btn = $("btn");
  const ok = $("ok");
  const bad = $("bad");
  const guestsEl = $("guests");

  form.action = SCRIPT_URL;

  // Date min = today
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, "0");
  const dd = String(today.getDate()).padStart(2, "0");
  dateEl.min = `${yyyy}-${mm}-${dd}`;

  function toMinutes(t){
    const [h,m] = t.split(":").map(Number);
    return h*60 + m;
  }

  function toHHMM(min){
    const h = String(Math.floor(min/60)).padStart(2,"0");
    const m = String(min%60).padStart(2,"0");
    return `${h}:${m}`;
  }

  function buildSlots(){
    const slots = [];
    let s = toMinutes(OPEN_HOURS.start);
    const e = toMinutes(OPEN_HOURS.end);
    while (s <= e){
      slots.push(toHHMM(s));
      s += SLOT_MINUTES;
    }
    return slots;
  }

  function parseYMD(ymd){
    const [y,m,d] = ymd.split("-").map(Number);
    return { y, m, d };
  }

  function isSameLocalDate(d1, d2){
    return d1.getFullYear() === d2.getFullYear()
      && d1.getMonth() === d2.getMonth()
      && d1.getDate() === d2.getDate();
  }

  function show(el, msg){
    ok.style.display = "none";
    bad.style.display = "none";
    if (msg) el.textContent = msg;
    el.style.display = "block";
  }

  function clearTimeUI(){
    timeGrid.innerHTML = "";
    timeEl.innerHTML = "";
    const opt = document.createElement("option");
    opt.value = "";
    opt.textContent = "Select a date first";
    timeEl.appendChild(opt);
    timeHint.textContent = "Select a date first";
  }

  function setSelectedTime(value){
    timeEl.value = value;
    const btns = timeGrid.querySelectorAll(".time-btn");
    btns.forEach(b => b.classList.toggle("selected", b.dataset.value === value));
    timeHint.textContent = value ? `Selected: ${value}` : "Please choose a time";
  }

  function refreshTimes(){
    const d = dateEl.value;

    if (!d){
      clearTimeUI();
      return;
    }

    const slots = buildSlots();

    // rebuild hidden select
    timeEl.innerHTML = "";
    const first = document.createElement("option");
    first.value = "";
    first.textContent = "Select";
    timeEl.appendChild(first);

    for (const s of slots){
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = s;
      timeEl.appendChild(opt);
    }

    // today check => disable past times
    const now = new Date();
    const { y, m, d:day } = parseYMD(d);
    const selectedDate = new Date(y, m - 1, day);
    const selectedIsToday = isSameLocalDate(selectedDate, now);
    const nowMinutes = now.getHours() * 60 + now.getMinutes();

    timeGrid.innerHTML = "";
    let hasEnabled = false;

    for (const s of slots){
      const b = document.createElement("button");
      b.type = "button";
      b.className = "time-btn";
      b.textContent = s;
      b.dataset.value = s;

      const slotMinutes = toMinutes(s);
      const shouldDisable = selectedIsToday && slotMinutes < nowMinutes;

      if (shouldDisable){
        b.classList.add("disabled");
        b.setAttribute("aria-disabled","true");
      } else {
        hasEnabled = true;
        b.addEventListener("click", () => setSelectedTime(s));
      }

      timeGrid.appendChild(b);
    }

    setSelectedTime("");
    timeHint.textContent = hasEnabled
      ? "Please choose a time"
      : "No available times left for today. Please pick another date.";
  }

  dateEl.addEventListener("change", refreshTimes);

  guestsEl.addEventListener("change", () => {
    if (guestsEl.value === "8+") {
      alert("For 8+ guests, please contact us to confirm availability.");
    }
  });

  // iframe onload => submission finished
  let pendingSubmit = false;

  form.addEventListener("submit", (e) => {
    if (!timeEl.value) {
      e.preventDefault();
      show(bad, "Please select a time.");
      return;
    }

    ok.style.display = "none";
    bad.style.display = "none";
    btn.disabled = true;
    btn.textContent = "Submitting...";
    pendingSubmit = true;

    setTimeout(() => {
      if (pendingSubmit) {
        pendingSubmit = false;
        btn.disabled = false;
        btn.textContent = "Request a booking";
        show(bad, "Submitted, but no confirmation returned. Please check the sheet.");
      }
    }, 10000);
  });

  iframe.addEventListener("load", () => {
    if (!pendingSubmit) return;
    pendingSubmit = false;

    btn.disabled = false;
    btn.textContent = "Request a booking";

    show(ok, "Submitted! We‚Äôll confirm shortly.");
    form.reset();
    refreshTimes();
  });

  refreshTimes();
</script>

</body>
</html>
